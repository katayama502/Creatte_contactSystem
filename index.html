<!doctype html>
<html lang="ja" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆæ¥­ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ </title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    // =====================================================
    // Firebaseè¨­å®šï¼ˆFirebase Consoleã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’å…¥åŠ›ï¼‰
    // https://console.firebase.google.com/
    // =====================================================
    const firebaseConfig = {
      apiKey: "AIzaSyA3KlUbxW5cl3zP3ucFC8t2YYC9U1Y5BdM",
      authDomain: "creatte-contactsystem.firebaseapp.com",
      projectId: "creatte-contactsystem",
      storageBucket: "creatte-contactsystem.firebasestorage.app",
      messagingSenderId: "796237166397",
      appId: "1:796237166397:web:681f3f14c262a8fc8c3754"
    };

    // Firebaseã‚’åˆæœŸåŒ–
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const COLLECTION = 'system_data';

    // =====================================================
    // dataSdk äº’æ›ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ä¸è¦ã«ã™ã‚‹ãŸã‚ï¼‰
    // =====================================================
    window.dataSdk = {
      _handler: null,
      _unsubscribe: null,

      async init(handler) {
        window.dataSdk._handler = handler;
        try {
          const q = query(collection(db, COLLECTION), orderBy('created_at', 'asc'));
          window.dataSdk._unsubscribe = onSnapshot(q, (snapshot) => {
            const data = snapshot.docs.map(d => ({ __backendId: d.id, ...d.data() }));
            if (handler && handler.onDataChanged) {
              handler.onDataChanged(data);
            }
          });
          return { isOk: true };
        } catch (e) {
          console.error('FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
          return { isOk: false, error: e };
        }
      },

      async create(data) {
        try {
          const { __backendId, ...cleanData } = data;
          const docRef = await addDoc(collection(db, COLLECTION), cleanData);
          return { isOk: true, id: docRef.id };
        } catch (e) {
          console.error('ä½œæˆã‚¨ãƒ©ãƒ¼:', e);
          return { isOk: false, error: e };
        }
      },

      async update(data) {
        try {
          const { __backendId, ...cleanData } = data;
          const docRef = doc(db, COLLECTION, __backendId);
          await updateDoc(docRef, cleanData);
          return { isOk: true };
        } catch (e) {
          console.error('æ›´æ–°ã‚¨ãƒ©ãƒ¼:', e);
          return { isOk: false, error: e };
        }
      },

      async delete(data) {
        try {
          const docRef = doc(db, COLLECTION, data.__backendId);
          await deleteDoc(docRef);
          return { isOk: true };
        } catch (e) {
          console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', e);
          return { isOk: false, error: e };
        }
      }
    };

    // elementSdk ã‚¹ã‚¿ãƒ–ï¼ˆè¨­å®šå¤‰æ›´æ©Ÿèƒ½ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«å¯¾å¿œï¼‰
    window.elementSdk = {
      init(options) {
        if (options && options.onConfigChange) {
          const config = {
            system_title: localStorage.getItem('system_title') || options.defaultConfig?.system_title || 'æˆæ¥­ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ',
            school_name: localStorage.getItem('school_name') || options.defaultConfig?.school_name || 'å­¦ç¿’å¡¾'
          };
          options.onConfigChange(config);
        }
      }
    };

    // DOMContentLoadedå¾Œã«initAppã‚’å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof initApp === 'function') initApp();
    });
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Noto Sans JP', sans-serif; }
    .sidebar-item { transition: all 0.2s ease; }
    .sidebar-item:hover { transform: translateX(4px); }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .pulse-dot { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    input:focus, select:focus, textarea:focus { outline: none; box-shadow: 0 0 0 3px rgba(0, 195, 95, 0.2); }
    .btn-primary { transition: all 0.2s ease; }
    .btn-primary:hover { transform: scale(1.02); }
    .btn-primary:active { transform: scale(0.98); }
    .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #00c35f; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full bg-slate-50 overflow-auto">
  <div class="flex h-full w-full"><!-- Sidebar -->
   <aside class="w-64 bg-gradient-to-b from-emerald-600 to-emerald-700 text-white flex-shrink-0 flex flex-col">
    <div class="p-6 border-b border-emerald-500">
     <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center">
       <svg class="w-6 h-6 text-emerald-600" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
       </svg>
      </div>
      <div>
       <h1 id="sidebar-title" class="font-bold text-lg">ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ </h1>
       <p id="sidebar-school" class="text-emerald-200 text-xs">ç®¡ç†ç”»é¢</p>
      </div>
     </div>
    </div>
    <nav class="flex-1 p-4 space-y-2"><button onclick="showSection('dashboard')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-emerald-500/30 text-white">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
      </svg><span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span> </button> <button onclick="showSection('api-settings')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-500/20 text-emerald-100">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg><span>LINE APIè¨­å®š</span> </button> <button onclick="showSection('students')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-500/20 text-emerald-100">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg><span>ç”Ÿå¾’ç®¡ç†</span> </button> <button onclick="showSection('schedules')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-500/20 text-emerald-100">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg><span>æˆæ¥­ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</span> </button> <button onclick="showSection('reminders')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-500/20 text-emerald-100">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
      </svg><span>ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š</span> </button> <button onclick="showSection('notifications')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-500/20 text-emerald-100">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
      </svg><span>ã‚¤ãƒ™ãƒ³ãƒˆå‘ŠçŸ¥</span> </button> <button onclick="showSection('logs')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-500/20 text-emerald-100">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
      </svg><span>é€ä¿¡ãƒ­ã‚°</span> </button>
    </nav>
    <div class="p-4 border-t border-emerald-500">
     <div class="flex items-center gap-3 px-4 py-2">
      <div class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center text-sm font-bold">
       ç®¡
      </div>
      <div class="text-sm">
       <p class="font-medium">ç®¡ç†è€…</p>
       <p class="text-emerald-200 text-xs">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</p>
      </div>
     </div>
    </div>
   </aside><!-- Main Content -->
   <main class="flex-1 overflow-auto"><!-- Dashboard Section -->
    <section id="section-dashboard" class="p-8 fade-in">
     <div class="mb-8">
      <h2 class="text-2xl font-bold text-slate-800">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
      <p class="text-slate-500 mt-1">ã‚·ã‚¹ãƒ†ãƒ ã®æ¦‚è¦ã¨ä»Šæ—¥ã®äºˆå®š</p>
     </div><!-- Stats Cards -->
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="card-hover bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
       <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
         <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
         </svg>
        </div><span class="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded-full">+12%</span>
       </div>
       <p id="stat-students" class="text-3xl font-bold text-slate-800">0</p>
       <p class="text-slate-500 text-sm mt-1">ç™»éŒ²ç”Ÿå¾’æ•°</p>
      </div>
      <div class="card-hover bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
       <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center">
         <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
         </svg>
        </div><span class="text-xs font-medium text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full">æœ¬æ—¥</span>
       </div>
       <p id="stat-today-classes" class="text-3xl font-bold text-slate-800">0</p>
       <p class="text-slate-500 text-sm mt-1">ä»Šæ—¥ã®æˆæ¥­æ•°</p>
      </div>
      <div class="card-hover bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
       <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center">
         <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
         </svg>
        </div><span class="text-xs font-medium text-amber-600 bg-amber-50 px-2 py-1 rounded-full">äºˆå®š</span>
       </div>
       <p id="stat-pending-reminders" class="text-3xl font-bold text-slate-800">0</p>
       <p class="text-slate-500 text-sm mt-1">é€ä¿¡äºˆå®šãƒªãƒã‚¤ãƒ³ãƒ‰</p>
      </div>
      <div class="card-hover bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
       <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
         <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg>
        </div><span id="api-status-badge" class="text-xs font-medium text-slate-600 bg-slate-100 px-2 py-1 rounded-full">æœªè¨­å®š</span>
       </div>
       <p id="stat-api-status" class="text-3xl font-bold text-slate-800">--</p>
       <p class="text-slate-500 text-sm mt-1">APIæ¥ç¶šçŠ¶æ³</p>
      </div>
     </div><!-- Today's Schedule -->
     <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
      <div class="p-6 border-b border-slate-100">
       <h3 class="text-lg font-bold text-slate-800">ä»Šæ—¥ã®æˆæ¥­ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h3>
      </div>
      <div id="today-schedule-list" class="divide-y divide-slate-100">
       <div class="p-8 text-center text-slate-400">
        <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <p>ä»Šæ—¥ã®æˆæ¥­ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
       </div>
      </div>
     </div>
    </section><!-- API Settings Section -->
    <section id="section-api-settings" class="p-8 fade-in hidden">
     <div class="mb-8">
      <h2 class="text-2xl font-bold text-slate-800">LINE APIè¨­å®š</h2>
      <p class="text-slate-500 mt-1">LINE Messaging APIã®æ¥ç¶šè¨­å®šã‚’è¡Œã„ã¾ã™</p>
     </div>
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
       <h3 class="text-lg font-bold text-slate-800 mb-6">åŸºæœ¬è¨­å®š</h3>
       <form id="api-settings-form" class="space-y-5">
        <div><label class="block text-sm font-medium text-slate-700 mb-2">Channel ID</label> <input type="text" id="channel-id" placeholder="1234567890" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors">
        </div>
        <div><label class="block text-sm font-medium text-slate-700 mb-2">Channel Secret</label> <input type="password" id="channel-secret" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors">
        </div>
        <div><label class="block text-sm font-medium text-slate-700 mb-2">ãƒãƒ£ãƒãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³</label> <textarea id="access-token" rows="3" placeholder="ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›..." class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors resize-none"></textarea>
        </div>
        <div><label class="block text-sm font-medium text-slate-700 mb-2">Webhook URL</label>
         <div class="flex gap-2"><input type="text" id="webhook-url" placeholder="https://your-server.com/webhook" class="flex-1 px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <button type="button" onclick="generateWebhookUrl()" class="px-4 py-3 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200 transition-colors">
           <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
           </svg></button>
         </div>
        </div>
        <div class="flex gap-3 pt-4"><button type="submit" id="save-api-btn" class="btn-primary flex-1 bg-emerald-600 text-white py-3 rounded-xl font-medium hover:bg-emerald-700 transition-colors"> <span class="btn-text">è¨­å®šã‚’ä¿å­˜</span> </button> <button type="button" onclick="testConnection()" class="px-6 py-3 border border-emerald-600 text-emerald-600 rounded-xl font-medium hover:bg-emerald-50 transition-colors"> æ¥ç¶šãƒ†ã‚¹ãƒˆ </button>
        </div>
       </form>
      </div>
      <div class="space-y-6">
       <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
        <h3 class="text-lg font-bold text-slate-800 mb-4">æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
        <div id="connection-status" class="flex items-center gap-3 p-4 bg-slate-50 rounded-xl">
         <div class="w-3 h-3 bg-slate-400 rounded-full"></div><span class="text-slate-600">æœªè¨­å®š</span>
        </div>
       </div>
       <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-6 text-white">
        <h3 class="text-lg font-bold mb-3">ğŸ“š è¨­å®šã‚¬ã‚¤ãƒ‰</h3>
        <ol class="space-y-2 text-emerald-50 text-sm">
         <li>1. LINE Developersã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³</li>
         <li>2. Messaging APIãƒãƒ£ãƒãƒ«ã‚’ä½œæˆ</li>
         <li>3. ãƒãƒ£ãƒãƒ«åŸºæœ¬è¨­å®šã‹ã‚‰IDãƒ»Secretã‚’å–å¾—</li>
         <li>4. Messaging APIè¨­å®šã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œ</li>
         <li>5. Webhook URLã‚’è¨­å®šã—ã¦æœ‰åŠ¹åŒ–</li>
        </ol><a href="https://developers.line.biz/console/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 mt-4 px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors text-sm"> LINE Developers â†’ </a>
       </div>
      </div>
     </div>
    </section><!-- Students Section -->
    <section id="section-students" class="p-8 fade-in hidden">
     <div class="flex items-center justify-between mb-8">
      <div>
       <h2 class="text-2xl font-bold text-slate-800">ç”Ÿå¾’ç®¡ç†</h2>
       <p class="text-slate-500 mt-1">ç”Ÿå¾’æƒ…å ±ã®ç™»éŒ²ãƒ»ç·¨é›†ã‚’è¡Œã„ã¾ã™</p>
      </div><button onclick="showStudentModal()" class="btn-primary flex items-center gap-2 bg-emerald-600 text-white px-5 py-3 rounded-xl font-medium hover:bg-emerald-700 transition-colors">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg> æ–°è¦ç™»éŒ² </button>
     </div>
     <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
      <div class="p-4 border-b border-slate-100 flex gap-4">
       <div class="flex-1 relative">
        <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg><input type="text" id="student-search" placeholder="ç”Ÿå¾’åã§æ¤œç´¢..." class="w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:border-emerald-500 transition-colors">
       </div><select id="student-filter" class="px-4 py-2 border border-slate-200 rounded-lg focus:border-emerald-500 transition-colors"> <option value="">å…¨ã¦ã®ã‚³ãƒ¼ã‚¹</option> <option value="æ•°å­¦">æ•°å­¦</option> <option value="è‹±èª">è‹±èª</option> <option value="å›½èª">å›½èª</option> <option value="ç†ç§‘">ç†ç§‘</option> <option value="ç¤¾ä¼š">ç¤¾ä¼š</option> </select>
      </div>
      <div id="students-list" class="divide-y divide-slate-100">
       <div class="p-8 text-center text-slate-400">
        <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <p>ç”Ÿå¾’ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p><button onclick="showStudentModal()" class="mt-3 text-emerald-600 hover:text-emerald-700 font-medium">æœ€åˆã®ç”Ÿå¾’ã‚’ç™»éŒ² â†’</button>
       </div>
      </div>
     </div>
    </section><!-- Schedules Section -->
    <section id="section-schedules" class="p-8 fade-in hidden">
     <div class="flex items-center justify-between mb-8">
      <div>
       <h2 class="text-2xl font-bold text-slate-800">æˆæ¥­ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h2>
       <p class="text-slate-500 mt-1">æˆæ¥­ã®ç™»éŒ²ãƒ»ç®¡ç†ã‚’è¡Œã„ã¾ã™</p>
      </div><button onclick="showScheduleModal()" class="btn-primary flex items-center gap-2 bg-emerald-600 text-white px-5 py-3 rounded-xl font-medium hover:bg-emerald-700 transition-colors">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg> æ–°è¦æˆæ¥­ </button>
     </div>
     <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
      <div class="p-4 border-b border-slate-100 flex gap-4 flex-wrap"><input type="date" id="schedule-date-filter" class="px-4 py-2 border border-slate-200 rounded-lg focus:border-emerald-500 transition-colors"> <select id="schedule-instructor-filter" class="px-4 py-2 border border-slate-200 rounded-lg focus:border-emerald-500 transition-colors"> <option value="">å…¨ã¦ã®è¬›å¸«</option> <option value="ç”°ä¸­å…ˆç”Ÿ">ç”°ä¸­å…ˆç”Ÿ</option> <option value="éˆ´æœ¨å…ˆç”Ÿ">éˆ´æœ¨å…ˆç”Ÿ</option> <option value="ä½è—¤å…ˆç”Ÿ">ä½è—¤å…ˆç”Ÿ</option> </select> <select id="schedule-status-filter" class="px-4 py-2 border border-slate-200 rounded-lg focus:border-emerald-500 transition-colors"> <option value="">å…¨ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option> <option value="äºˆå®š">äºˆå®š</option> <option value="å®Œäº†">å®Œäº†</option> <option value="æ¬ å¸­">æ¬ å¸­</option> <option value="æŒ¯æ›¿å¾…ã¡">æŒ¯æ›¿å¾…ã¡</option> </select>
      </div>
      <div id="schedules-list" class="divide-y divide-slate-100">
       <div class="p-8 text-center text-slate-400">
        <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <p>æˆæ¥­ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p><button onclick="showScheduleModal()" class="mt-3 text-emerald-600 hover:text-emerald-700 font-medium">æœ€åˆã®æˆæ¥­ã‚’ç™»éŒ² â†’</button>
       </div>
      </div>
     </div>
    </section><!-- Reminders Section -->
    <section id="section-reminders" class="p-8 fade-in hidden">
     <div class="mb-8">
      <h2 class="text-2xl font-bold text-slate-800">ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š</h2>
      <p class="text-slate-500 mt-1">è‡ªå‹•ãƒªãƒã‚¤ãƒ³ãƒ‰ã®é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¨­å®šã—ã¾ã™</p>
     </div>
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
       <h3 class="text-lg font-bold text-slate-800 mb-6">é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¨­å®š</h3>
       <div class="space-y-4"><label class="flex items-center justify-between p-4 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition-colors">
         <div class="flex items-center gap-3"><input type="checkbox" id="reminder-24h" checked class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500">
          <div>
           <p class="font-medium text-slate-800">24æ™‚é–“å‰</p>
           <p class="text-sm text-slate-500">æˆæ¥­ã®å‰æ—¥ã«é€ä¿¡</p>
          </div>
         </div><span class="text-emerald-600 text-sm font-medium">æœ‰åŠ¹</span> </label> <label class="flex items-center justify-between p-4 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition-colors">
         <div class="flex items-center gap-3"><input type="checkbox" id="reminder-3h" checked class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500">
          <div>
           <p class="font-medium text-slate-800">3æ™‚é–“å‰</p>
           <p class="text-sm text-slate-500">å½“æ—¥ã®ç›´å‰ã«é€ä¿¡</p>
          </div>
         </div><span class="text-emerald-600 text-sm font-medium">æœ‰åŠ¹</span> </label> <label class="flex items-center justify-between p-4 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition-colors">
         <div class="flex items-center gap-3"><input type="checkbox" id="reminder-1h" class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500">
          <div>
           <p class="font-medium text-slate-800">1æ™‚é–“å‰</p>
           <p class="text-sm text-slate-500">æˆæ¥­ã®ç›´å‰ã«é€ä¿¡</p>
          </div>
         </div><span class="text-slate-400 text-sm">ç„¡åŠ¹</span> </label>
       </div>
      </div>
      <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
       <h3 class="text-lg font-bold text-slate-800 mb-6">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
       <div class="space-y-4">
        <div><label class="block text-sm font-medium text-slate-700 mb-2">24æ™‚é–“å‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label> <textarea id="template-24h" rows="4" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors resize-none">{ç”Ÿå¾’å}ã•ã‚“ã€æ˜æ—¥ã®æˆæ¥­ã®ãŠçŸ¥ã‚‰ã›ã§ã™ã€‚

ğŸ“… {æ—¥æ™‚}
ğŸ“š {ç§‘ç›®}
ğŸ‘¨â€ğŸ« {æ‹…å½“è¬›å¸«}

ã”äºˆå®šã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãŠæ‰‹ç¶šããã ã•ã„ã€‚</textarea>
        </div>
        <div class="flex flex-wrap gap-2"><span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full">{ç”Ÿå¾’å}</span> <span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full">{æ—¥æ™‚}</span> <span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full">{ç§‘ç›®}</span> <span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full">{æ‹…å½“è¬›å¸«}</span>
        </div><button onclick="saveReminderSettings()" class="btn-primary w-full bg-emerald-600 text-white py-3 rounded-xl font-medium hover:bg-emerald-700 transition-colors"> è¨­å®šã‚’ä¿å­˜ </button>
       </div>
      </div>
     </div>
    </section><!-- Notifications Section -->
    <section id="section-notifications" class="p-8 fade-in hidden">
     <div class="flex items-center justify-between mb-8">
      <div>
       <h2 class="text-2xl font-bold text-slate-800">ã‚¤ãƒ™ãƒ³ãƒˆå‘ŠçŸ¥</h2>
       <p class="text-slate-500 mt-1">ç‰¹åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆã‚„ä¸€æ–‰é€šçŸ¥ã‚’é…ä¿¡ã—ã¾ã™</p>
      </div><button onclick="showNotificationModal()" class="btn-primary flex items-center gap-2 bg-emerald-600 text-white px-5 py-3 rounded-xl font-medium hover:bg-emerald-700 transition-colors">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
       </svg> æ–°è¦å‘ŠçŸ¥ </button>
     </div>
     <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
      <div id="notifications-list" class="divide-y divide-slate-100">
       <div class="p-8 text-center text-slate-400">
        <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
        </svg>
        <p>å‘ŠçŸ¥ãŒã¾ã ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“</p><button onclick="showNotificationModal()" class="mt-3 text-emerald-600 hover:text-emerald-700 font-medium">æœ€åˆã®å‘ŠçŸ¥ã‚’ä½œæˆ â†’</button>
       </div>
      </div>
     </div>
    </section><!-- Logs Section -->
    <section id="section-logs" class="p-8 fade-in hidden">
     <div class="mb-8">
      <h2 class="text-2xl font-bold text-slate-800">é€ä¿¡ãƒ­ã‚°</h2>
      <p class="text-slate-500 mt-1">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡å±¥æ­´ã‚’ç¢ºèªã—ã¾ã™</p>
     </div>
     <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
      <div class="p-4 border-b border-slate-100 flex gap-4 flex-wrap"><input type="date" id="log-date-filter" class="px-4 py-2 border border-slate-200 rounded-lg focus:border-emerald-500 transition-colors"> <select id="log-type-filter" class="px-4 py-2 border border-slate-200 rounded-lg focus:border-emerald-500 transition-colors"> <option value="">å…¨ã¦ã®ã‚¿ã‚¤ãƒ—</option> <option value="ãƒªãƒã‚¤ãƒ³ãƒ‰">ãƒªãƒã‚¤ãƒ³ãƒ‰</option> <option value="å‘ŠçŸ¥">å‘ŠçŸ¥</option> </select> <select id="log-status-filter" class="px-4 py-2 border border-slate-200 rounded-lg focus:border-emerald-500 transition-colors"> <option value="">å…¨ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option> <option value="æˆåŠŸ">æˆåŠŸ</option> <option value="å¤±æ•—">å¤±æ•—</option> <option value="ä¿ç•™">ä¿ç•™</option> </select>
      </div>
      <div id="logs-list" class="divide-y divide-slate-100">
       <div class="p-8 text-center text-slate-400">
        <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
        </svg>
        <p>é€ä¿¡ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“</p>
       </div>
      </div>
     </div>
    </section>
   </main>
  </div><!-- Student Modal -->
  <div id="student-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-2xl w-full max-w-md mx-4 overflow-hidden fade-in">
    <div class="p-6 border-b border-slate-100 flex items-center justify-between">
     <h3 class="text-lg font-bold text-slate-800">ç”Ÿå¾’ç™»éŒ²</h3><button onclick="closeModal('student-modal')" class="p-2 hover:bg-slate-100 rounded-lg transition-colors">
      <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form id="student-form" class="p-6 space-y-4"><input type="hidden" id="student-edit-id" value="">
     <div><label class="block text-sm font-medium text-slate-700 mb-2">ç”Ÿå¾’å <span class="text-red-500">*</span></label> <input type="text" id="student-name" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors" placeholder="å±±ç”° å¤ªéƒ">
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">LINE UserID</label> <input type="text" id="student-line-id" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors" placeholder="U1234567890abc...">
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">ã‚³ãƒ¼ã‚¹ <span class="text-red-500">*</span></label> <select id="student-course" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <option value="">é¸æŠã—ã¦ãã ã•ã„</option> <option value="æ•°å­¦">æ•°å­¦</option> <option value="è‹±èª">è‹±èª</option> <option value="å›½èª">å›½èª</option> <option value="ç†ç§‘">ç†ç§‘</option> <option value="ç¤¾ä¼š">ç¤¾ä¼š</option> <option value="ç·åˆ">ç·åˆï¼ˆè¤‡æ•°ç§‘ç›®ï¼‰</option> </select>
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label> <select id="student-status" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <option value="æœ‰åŠ¹">æœ‰åŠ¹</option> <option value="ä¼‘ä¼š">ä¼‘ä¼š</option> <option value="é€€ä¼š">é€€ä¼š</option> </select>
     </div>
     <div class="flex gap-3 pt-4"><button type="button" onclick="closeModal('student-modal')" class="flex-1 py-3 border border-slate-200 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-colors">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button type="submit" id="save-student-btn" class="btn-primary flex-1 bg-emerald-600 text-white py-3 rounded-xl font-medium hover:bg-emerald-700 transition-colors"> <span class="btn-text">ä¿å­˜</span> </button>
     </div>
    </form>
   </div>
  </div><!-- Schedule Modal -->
  <div id="schedule-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-2xl w-full max-w-md mx-4 overflow-hidden fade-in">
    <div class="p-6 border-b border-slate-100 flex items-center justify-between">
     <h3 class="text-lg font-bold text-slate-800">æˆæ¥­ç™»éŒ²</h3><button onclick="closeModal('schedule-modal')" class="p-2 hover:bg-slate-100 rounded-lg transition-colors">
      <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form id="schedule-form" class="p-6 space-y-4"><input type="hidden" id="schedule-edit-id" value="">
     <div class="grid grid-cols-2 gap-4">
      <div><label class="block text-sm font-medium text-slate-700 mb-2">æ—¥ä»˜ <span class="text-red-500">*</span></label> <input type="date" id="schedule-date" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors">
      </div>
      <div><label class="block text-sm font-medium text-slate-700 mb-2">æ™‚é–“ <span class="text-red-500">*</span></label> <input type="time" id="schedule-time" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors">
      </div>
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">ç”Ÿå¾’ <span class="text-red-500">*</span></label> <select id="schedule-student" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <option value="">é¸æŠã—ã¦ãã ã•ã„</option> </select>
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">ç§‘ç›® <span class="text-red-500">*</span></label> <select id="schedule-subject" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <option value="">é¸æŠã—ã¦ãã ã•ã„</option> <option value="æ•°å­¦">æ•°å­¦</option> <option value="è‹±èª">è‹±èª</option> <option value="å›½èª">å›½èª</option> <option value="ç†ç§‘">ç†ç§‘</option> <option value="ç¤¾ä¼š">ç¤¾ä¼š</option> </select>
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">æ‹…å½“è¬›å¸« <span class="text-red-500">*</span></label> <select id="schedule-instructor" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <option value="">é¸æŠã—ã¦ãã ã•ã„</option> <option value="ç”°ä¸­å…ˆç”Ÿ">ç”°ä¸­å…ˆç”Ÿ</option> <option value="éˆ´æœ¨å…ˆç”Ÿ">éˆ´æœ¨å…ˆç”Ÿ</option> <option value="ä½è—¤å…ˆç”Ÿ">ä½è—¤å…ˆç”Ÿ</option> </select>
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">å‡ºæ¬ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label> <select id="schedule-attendance" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <option value="äºˆå®š">äºˆå®š</option> <option value="å®Œäº†">å®Œäº†</option> <option value="æ¬ å¸­">æ¬ å¸­</option> <option value="æŒ¯æ›¿å¾…ã¡">æŒ¯æ›¿å¾…ã¡</option> </select>
     </div>
     <div class="flex gap-3 pt-4"><button type="button" onclick="closeModal('schedule-modal')" class="flex-1 py-3 border border-slate-200 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-colors">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button type="submit" id="save-schedule-btn" class="btn-primary flex-1 bg-emerald-600 text-white py-3 rounded-xl font-medium hover:bg-emerald-700 transition-colors"> <span class="btn-text">ä¿å­˜</span> </button>
     </div>
    </form>
   </div>
  </div><!-- Notification Modal -->
  <div id="notification-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-2xl w-full max-w-lg mx-4 overflow-hidden fade-in">
    <div class="p-6 border-b border-slate-100 flex items-center justify-between">
     <h3 class="text-lg font-bold text-slate-800">ã‚¤ãƒ™ãƒ³ãƒˆå‘ŠçŸ¥ä½œæˆ</h3><button onclick="closeModal('notification-modal')" class="p-2 hover:bg-slate-100 rounded-lg transition-colors">
      <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form id="notification-form" class="p-6 space-y-4">
     <div><label class="block text-sm font-medium text-slate-700 mb-2">é…ä¿¡å¯¾è±¡</label> <select id="notification-target" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <option value="å…¨ç”Ÿå¾’">å…¨ç”Ÿå¾’</option> <option value="æ•°å­¦ã‚³ãƒ¼ã‚¹">æ•°å­¦ã‚³ãƒ¼ã‚¹</option> <option value="è‹±èªã‚³ãƒ¼ã‚¹">è‹±èªã‚³ãƒ¼ã‚¹</option> <option value="å›½èªã‚³ãƒ¼ã‚¹">å›½èªã‚³ãƒ¼ã‚¹</option> </select>
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">é€ä¿¡æ—¥æ™‚</label>
      <div class="grid grid-cols-2 gap-4"><input type="date" id="notification-date" class="px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors"> <input type="time" id="notification-time" class="px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors">
      </div>
      <p class="text-xs text-slate-500 mt-1">ç©ºæ¬„ã®å ´åˆã¯å³æ™‚é€ä¿¡ã•ã‚Œã¾ã™</p>
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-2">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ <span class="text-red-500">*</span></label> <textarea id="notification-content" rows="5" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:border-emerald-500 transition-colors resize-none" placeholder="å‘ŠçŸ¥å†…å®¹ã‚’å…¥åŠ›..."></textarea>
     </div>
     <div class="flex gap-3 pt-4"><button type="button" onclick="closeModal('notification-modal')" class="flex-1 py-3 border border-slate-200 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-colors">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button type="submit" id="save-notification-btn" class="btn-primary flex-1 bg-emerald-600 text-white py-3 rounded-xl font-medium hover:bg-emerald-700 transition-colors"> <span class="btn-text">ä½œæˆ</span> </button>
     </div>
    </form>
   </div>
  </div><!-- Toast Container -->
  <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div><!-- Delete Confirmation Modal -->
  <div id="delete-confirm-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-2xl w-full max-w-sm mx-4 overflow-hidden fade-in">
    <div class="p-6 text-center">
     <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
     </div>
     <h3 class="text-lg font-bold text-slate-800 mb-2">å‰Šé™¤ã®ç¢ºèª</h3>
     <p id="delete-confirm-message" class="text-slate-500 mb-6">ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</p>
     <div class="flex gap-3"><button onclick="closeModal('delete-confirm-modal')" class="flex-1 py-3 border border-slate-200 rounded-xl font-medium text-slate-600 hover:bg-slate-50 transition-colors">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button id="delete-confirm-btn" class="flex-1 py-3 bg-red-600 text-white rounded-xl font-medium hover:bg-red-700 transition-colors">å‰Šé™¤ã™ã‚‹</button>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Global state
    let allData = [];
    let currentDeleteTarget = null;
    
    // Default config
    const defaultConfig = {
      system_title: 'æˆæ¥­ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ',
      school_name: 'å­¦ç¿’å¡¾'
    };

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          document.getElementById('sidebar-title').textContent = config.system_title || defaultConfig.system_title;
          document.getElementById('sidebar-school').textContent = config.school_name || defaultConfig.school_name;
        },
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['system_title', config.system_title || defaultConfig.system_title],
          ['school_name', config.school_name || defaultConfig.school_name]
        ])
      });
    }

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        updateDashboard();
        renderStudentsList();
        renderSchedulesList();
        renderNotificationsList();
        renderLogsList();
        updateStudentDropdown();
        updateApiStatus();
      }
    };

    // Initialize Data SDK
    async function initApp() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          showToast('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
      }
    }
    
    // initApp()ã¯Firebase moduleã‚¹ã‚¯ãƒªãƒ—ãƒˆã®DOMContentLoadedã‹ã‚‰å‘¼ã°ã‚Œã¾ã™
    // initApp(); // â† ç›´æ¥å‘¼ã³å‡ºã—ã¯ä¸è¦

    // Helper functions
    function getDataByType(type) {
      return allData.filter(item => item.type === type);
    }

    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('main > section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      const targetSection = document.getElementById(`section-${sectionId}`);
      if (targetSection) {
        targetSection.classList.remove('hidden');
      }
      
      // Update sidebar
      document.querySelectorAll('.sidebar-item').forEach((item, index) => {
        const sectionNames = ['dashboard', 'api-settings', 'students', 'schedules', 'reminders', 'notifications', 'logs'];
        if (sectionNames[index] === sectionId) {
          item.classList.add('bg-emerald-500/30', 'text-white');
          item.classList.remove('hover:bg-emerald-500/20', 'text-emerald-100');
        } else {
          item.classList.remove('bg-emerald-500/30', 'text-white');
          item.classList.add('hover:bg-emerald-500/20', 'text-emerald-100');
        }
      });
    }

    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? 'bg-emerald-600' : type === 'error' ? 'bg-red-600' : 'bg-amber-600';
      toast.className = `${bgColor} text-white px-6 py-3 rounded-xl shadow-lg fade-in flex items-center gap-3`;
      
      const icon = type === 'success' ? 
        '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>' :
        '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
      
      toast.innerHTML = `${icon}<span>${message}</span>`;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        toast.style.transition = 'all 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      return date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    function formatTime(timeStr) {
      if (!timeStr) return '';
      return timeStr;
    }

    // Dashboard
    function updateDashboard() {
      const students = getDataByType('student');
      const schedules = getDataByType('schedule');
      const notifications = getDataByType('notification');
      
      document.getElementById('stat-students').textContent = students.length;
      
      const today = new Date().toISOString().split('T')[0];
      const todayClasses = schedules.filter(s => s.schedule_date === today);
      document.getElementById('stat-today-classes').textContent = todayClasses.length;
      
      const pendingNotifications = notifications.filter(n => n.notification_status === 'ä¿ç•™');
      document.getElementById('stat-pending-reminders').textContent = pendingNotifications.length;
      
      // Render today's schedule
      const todayScheduleList = document.getElementById('today-schedule-list');
      if (todayClasses.length === 0) {
        todayScheduleList.innerHTML = `
          <div class="p-8 text-center text-slate-400">
            <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            <p>ä»Šæ—¥ã®æˆæ¥­ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
          </div>`;
      } else {
        todayScheduleList.innerHTML = todayClasses.map(schedule => `
          <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center text-emerald-600 font-bold">
                ${schedule.schedule_time ? schedule.schedule_time.substring(0, 5) : '--:--'}
              </div>
              <div>
                <p class="font-medium text-slate-800">${schedule.student_name || 'æœªè¨­å®š'}</p>
                <p class="text-sm text-slate-500">${schedule.subject || ''} - ${schedule.instructor || ''}</p>
              </div>
            </div>
            <span class="px-3 py-1 text-xs font-medium rounded-full ${getStatusColor(schedule.attendance)}">${schedule.attendance || 'äºˆå®š'}</span>
          </div>
        `).join('');
      }
    }

    function getStatusColor(status) {
      switch(status) {
        case 'å®Œäº†': return 'bg-emerald-100 text-emerald-700';
        case 'æ¬ å¸­': return 'bg-red-100 text-red-700';
        case 'æŒ¯æ›¿å¾…ã¡': return 'bg-amber-100 text-amber-700';
        default: return 'bg-blue-100 text-blue-700';
      }
    }

    // API Settings
    function updateApiStatus() {
      const apiSettings = getDataByType('api_settings')[0];
      const statusEl = document.getElementById('connection-status');
      const statEl = document.getElementById('stat-api-status');
      const badgeEl = document.getElementById('api-status-badge');
      
      if (apiSettings && apiSettings.channel_id && apiSettings.access_token) {
        statusEl.innerHTML = `
          <div class="w-3 h-3 bg-emerald-500 rounded-full pulse-dot"></div>
          <span class="text-emerald-600 font-medium">æ¥ç¶šæ¸ˆã¿</span>`;
        statEl.textContent = 'æ¥ç¶šä¸­';
        badgeEl.textContent = 'æ¥ç¶šæ¸ˆ';
        badgeEl.className = 'text-xs font-medium text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full';
        
        // Fill form
        document.getElementById('channel-id').value = apiSettings.channel_id || '';
        document.getElementById('channel-secret').value = apiSettings.channel_secret || '';
        document.getElementById('access-token').value = apiSettings.access_token || '';
        document.getElementById('webhook-url').value = apiSettings.webhook_url || '';
      } else {
        statusEl.innerHTML = `
          <div class="w-3 h-3 bg-slate-400 rounded-full"></div>
          <span class="text-slate-600">æœªè¨­å®š</span>`;
        statEl.textContent = '--';
        badgeEl.textContent = 'æœªè¨­å®š';
        badgeEl.className = 'text-xs font-medium text-slate-600 bg-slate-100 px-2 py-1 rounded-full';
      }
    }

    document.getElementById('api-settings-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('save-api-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-spinner"></span>';
      
      const existingSettings = getDataByType('api_settings')[0];
      const settingsData = {
        type: 'api_settings',
        channel_id: document.getElementById('channel-id').value,
        channel_secret: document.getElementById('channel-secret').value,
        access_token: document.getElementById('access-token').value,
        webhook_url: document.getElementById('webhook-url').value,
        created_at: new Date().toISOString()
      };
      
      let result;
      if (existingSettings) {
        result = await window.dataSdk.update({ ...existingSettings, ...settingsData });
      } else {
        if (allData.length >= 999) {
          showToast('ãƒ‡ãƒ¼ã‚¿ä¸Šé™ï¼ˆ999ä»¶ï¼‰ã«é”ã—ã¾ã—ãŸ', 'error');
          btn.disabled = false;
          btn.innerHTML = '<span class="btn-text">è¨­å®šã‚’ä¿å­˜</span>';
          return;
        }
        result = await window.dataSdk.create(settingsData);
      }
      
      btn.disabled = false;
      btn.innerHTML = '<span class="btn-text">è¨­å®šã‚’ä¿å­˜</span>';
      
      if (result.isOk) {
        showToast('APIè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
      } else {
        showToast('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    });

    function generateWebhookUrl() {
      const url = `https://your-server.com/webhook/${Date.now()}`;
      document.getElementById('webhook-url').value = url;
      showToast('Webhook URLã‚’ç”Ÿæˆã—ã¾ã—ãŸ');
    }

    function testConnection() {
      const channelId = document.getElementById('channel-id').value;
      const accessToken = document.getElementById('access-token').value;
      
      if (!channelId || !accessToken) {
        showToast('Channel IDã¨ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
        return;
      }
      
      showToast('æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...ã“ã®ãƒ‡ãƒ¢ã§ã¯å¸¸ã«æˆåŠŸã—ã¾ã™');
      setTimeout(() => {
        showToast('æ¥ç¶šãƒ†ã‚¹ãƒˆã«æˆåŠŸã—ã¾ã—ãŸ');
      }, 1500);
    }

    // Students Management
    function showStudentModal(student = null) {
      const modal = document.getElementById('student-modal');
      const form = document.getElementById('student-form');
      
      if (student) {
        document.getElementById('student-edit-id').value = student.__backendId;
        document.getElementById('student-name').value = student.student_name || '';
        document.getElementById('student-line-id').value = student.student_line_id || '';
        document.getElementById('student-course').value = student.course || '';
        document.getElementById('student-status').value = student.status || 'æœ‰åŠ¹';
      } else {
        form.reset();
        document.getElementById('student-edit-id').value = '';
      }
      
      modal.classList.remove('hidden');
    }

    document.getElementById('student-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('save-student-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-spinner"></span>';
      
      const editId = document.getElementById('student-edit-id').value;
      const studentData = {
        type: 'student',
        student_name: document.getElementById('student-name').value,
        student_line_id: document.getElementById('student-line-id').value,
        course: document.getElementById('student-course').value,
        status: document.getElementById('student-status').value,
        created_at: new Date().toISOString()
      };
      
      let result;
      if (editId) {
        const existingStudent = allData.find(d => d.__backendId === editId);
        result = await window.dataSdk.update({ ...existingStudent, ...studentData });
      } else {
        if (allData.length >= 999) {
          showToast('ãƒ‡ãƒ¼ã‚¿ä¸Šé™ï¼ˆ999ä»¶ï¼‰ã«é”ã—ã¾ã—ãŸ', 'error');
          btn.disabled = false;
          btn.innerHTML = '<span class="btn-text">ä¿å­˜</span>';
          return;
        }
        result = await window.dataSdk.create(studentData);
      }
      
      btn.disabled = false;
      btn.innerHTML = '<span class="btn-text">ä¿å­˜</span>';
      
      if (result.isOk) {
        showToast(editId ? 'ç”Ÿå¾’æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ' : 'ç”Ÿå¾’ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
        closeModal('student-modal');
      } else {
        showToast('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    });

    function renderStudentsList() {
      const students = getDataByType('student');
      const container = document.getElementById('students-list');
      const searchTerm = document.getElementById('student-search')?.value?.toLowerCase() || '';
      const filterCourse = document.getElementById('student-filter')?.value || '';
      
      let filteredStudents = students;
      if (searchTerm) {
        filteredStudents = filteredStudents.filter(s => 
          (s.student_name || '').toLowerCase().includes(searchTerm)
        );
      }
      if (filterCourse) {
        filteredStudents = filteredStudents.filter(s => s.course === filterCourse);
      }
      
      if (filteredStudents.length === 0) {
        container.innerHTML = `
          <div class="p-8 text-center text-slate-400">
            <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
            <p>${searchTerm || filterCourse ? 'æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“' : 'ç”Ÿå¾’ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“'}</p>
            ${!searchTerm && !filterCourse ? '<button onclick="showStudentModal()" class="mt-3 text-emerald-600 hover:text-emerald-700 font-medium">æœ€åˆã®ç”Ÿå¾’ã‚’ç™»éŒ² â†’</button>' : ''}
          </div>`;
        return;
      }
      
      container.innerHTML = filteredStudents.map(student => `
        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center text-white font-bold">
              ${(student.student_name || '?').substring(0, 1)}
            </div>
            <div>
              <p class="font-medium text-slate-800">${student.student_name || 'æœªè¨­å®š'}</p>
              <p class="text-sm text-slate-500">${student.course || ''} ${student.student_line_id ? 'â€¢ LINEé€£æºæ¸ˆ' : ''}</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <span class="px-3 py-1 text-xs font-medium rounded-full ${student.status === 'æœ‰åŠ¹' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'}">${student.status || 'æœ‰åŠ¹'}</span>
            <button onclick='showStudentModal(${JSON.stringify(student).replace(/'/g, "\\'")})' class="p-2 hover:bg-slate-100 rounded-lg transition-colors text-slate-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
            </button>
            <button onclick="confirmDelete('student', '${student.__backendId}', '${student.student_name}')" class="p-2 hover:bg-red-50 rounded-lg transition-colors text-slate-500 hover:text-red-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    document.getElementById('student-search')?.addEventListener('input', renderStudentsList);
    document.getElementById('student-filter')?.addEventListener('change', renderStudentsList);

    function updateStudentDropdown() {
      const students = getDataByType('student').filter(s => s.status === 'æœ‰åŠ¹');
      const dropdown = document.getElementById('schedule-student');
      if (dropdown) {
        dropdown.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' + 
          students.map(s => `<option value="${s.student_name}">${s.student_name}</option>`).join('');
      }
    }

    // Schedules Management
    function showScheduleModal(schedule = null) {
      const modal = document.getElementById('schedule-modal');
      const form = document.getElementById('schedule-form');
      
      updateStudentDropdown();
      
      if (schedule) {
        document.getElementById('schedule-edit-id').value = schedule.__backendId;
        document.getElementById('schedule-date').value = schedule.schedule_date || '';
        document.getElementById('schedule-time').value = schedule.schedule_time || '';
        document.getElementById('schedule-student').value = schedule.student_name || '';
        document.getElementById('schedule-subject').value = schedule.subject || '';
        document.getElementById('schedule-instructor').value = schedule.instructor || '';
        document.getElementById('schedule-attendance').value = schedule.attendance || 'äºˆå®š';
      } else {
        form.reset();
        document.getElementById('schedule-edit-id').value = '';
      }
      
      modal.classList.remove('hidden');
    }

    document.getElementById('schedule-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('save-schedule-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-spinner"></span>';
      
      const editId = document.getElementById('schedule-edit-id').value;
      const scheduleData = {
        type: 'schedule',
        schedule_date: document.getElementById('schedule-date').value,
        schedule_time: document.getElementById('schedule-time').value,
        student_name: document.getElementById('schedule-student').value,
        subject: document.getElementById('schedule-subject').value,
        instructor: document.getElementById('schedule-instructor').value,
        attendance: document.getElementById('schedule-attendance').value,
        created_at: new Date().toISOString()
      };
      
      let result;
      if (editId) {
        const existingSchedule = allData.find(d => d.__backendId === editId);
        result = await window.dataSdk.update({ ...existingSchedule, ...scheduleData });
      } else {
        if (allData.length >= 999) {
          showToast('ãƒ‡ãƒ¼ã‚¿ä¸Šé™ï¼ˆ999ä»¶ï¼‰ã«é”ã—ã¾ã—ãŸ', 'error');
          btn.disabled = false;
          btn.innerHTML = '<span class="btn-text">ä¿å­˜</span>';
          return;
        }
        result = await window.dataSdk.create(scheduleData);
      }
      
      btn.disabled = false;
      btn.innerHTML = '<span class="btn-text">ä¿å­˜</span>';
      
      if (result.isOk) {
        showToast(editId ? 'æˆæ¥­ã‚’æ›´æ–°ã—ã¾ã—ãŸ' : 'æˆæ¥­ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
        closeModal('schedule-modal');
      } else {
        showToast('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    });

    function renderSchedulesList() {
      const schedules = getDataByType('schedule');
      const container = document.getElementById('schedules-list');
      const dateFilter = document.getElementById('schedule-date-filter')?.value || '';
      const instructorFilter = document.getElementById('schedule-instructor-filter')?.value || '';
      const statusFilter = document.getElementById('schedule-status-filter')?.value || '';
      
      let filteredSchedules = schedules;
      if (dateFilter) {
        filteredSchedules = filteredSchedules.filter(s => s.schedule_date === dateFilter);
      }
      if (instructorFilter) {
        filteredSchedules = filteredSchedules.filter(s => s.instructor === instructorFilter);
      }
      if (statusFilter) {
        filteredSchedules = filteredSchedules.filter(s => s.attendance === statusFilter);
      }
      
      // Sort by date and time
      filteredSchedules.sort((a, b) => {
        const dateCompare = (a.schedule_date || '').localeCompare(b.schedule_date || '');
        if (dateCompare !== 0) return dateCompare;
        return (a.schedule_time || '').localeCompare(b.schedule_time || '');
      });
      
      if (filteredSchedules.length === 0) {
        container.innerHTML = `
          <div class="p-8 text-center text-slate-400">
            <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            <p>${dateFilter || instructorFilter || statusFilter ? 'æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“' : 'æˆæ¥­ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“'}</p>
            ${!dateFilter && !instructorFilter && !statusFilter ? '<button onclick="showScheduleModal()" class="mt-3 text-emerald-600 hover:text-emerald-700 font-medium">æœ€åˆã®æˆæ¥­ã‚’ç™»éŒ² â†’</button>' : ''}
          </div>`;
        return;
      }
      
      container.innerHTML = filteredSchedules.map(schedule => `
        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
          <div class="flex items-center gap-4">
            <div class="text-center">
              <p class="text-sm text-slate-500">${formatDate(schedule.schedule_date)}</p>
              <p class="text-lg font-bold text-slate-800">${schedule.schedule_time ? schedule.schedule_time.substring(0, 5) : '--:--'}</p>
            </div>
            <div class="w-px h-12 bg-slate-200"></div>
            <div>
              <p class="font-medium text-slate-800">${schedule.student_name || 'æœªè¨­å®š'}</p>
              <p class="text-sm text-slate-500">${schedule.subject || ''} - ${schedule.instructor || ''}</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <span class="px-3 py-1 text-xs font-medium rounded-full ${getStatusColor(schedule.attendance)}">${schedule.attendance || 'äºˆå®š'}</span>
            <button onclick='showScheduleModal(${JSON.stringify(schedule).replace(/'/g, "\\'")})' class="p-2 hover:bg-slate-100 rounded-lg transition-colors text-slate-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
            </button>
            <button onclick="confirmDelete('schedule', '${schedule.__backendId}', '${schedule.student_name}ã®æˆæ¥­')" class="p-2 hover:bg-red-50 rounded-lg transition-colors text-slate-500 hover:text-red-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    document.getElementById('schedule-date-filter')?.addEventListener('change', renderSchedulesList);
    document.getElementById('schedule-instructor-filter')?.addEventListener('change', renderSchedulesList);
    document.getElementById('schedule-status-filter')?.addEventListener('change', renderSchedulesList);

    // Reminder Settings
    function saveReminderSettings() {
      showToast('ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
    }

    // Notifications Management
    function showNotificationModal() {
      const modal = document.getElementById('notification-modal');
      document.getElementById('notification-form').reset();
      modal.classList.remove('hidden');
    }

    document.getElementById('notification-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('save-notification-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-spinner"></span>';
      
      if (allData.length >= 999) {
        showToast('ãƒ‡ãƒ¼ã‚¿ä¸Šé™ï¼ˆ999ä»¶ï¼‰ã«é”ã—ã¾ã—ãŸ', 'error');
        btn.disabled = false;
        btn.innerHTML = '<span class="btn-text">ä½œæˆ</span>';
        return;
      }
      
      const notificationData = {
        type: 'notification',
        notification_type: document.getElementById('notification-target').value,
        notification_date: document.getElementById('notification-date').value || new Date().toISOString().split('T')[0],
        notification_content: document.getElementById('notification-content').value,
        notification_status: document.getElementById('notification-date').value ? 'ä¿ç•™' : 'é€ä¿¡æ¸ˆ',
        created_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(notificationData);
      
      btn.disabled = false;
      btn.innerHTML = '<span class="btn-text">ä½œæˆ</span>';
      
      if (result.isOk) {
        showToast('å‘ŠçŸ¥ã‚’ä½œæˆã—ã¾ã—ãŸ');
        closeModal('notification-modal');
      } else {
        showToast('ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    });

    function renderNotificationsList() {
      const notifications = getDataByType('notification');
      const container = document.getElementById('notifications-list');
      
      if (notifications.length === 0) {
        container.innerHTML = `
          <div class="p-8 text-center text-slate-400">
            <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/></svg>
            <p>å‘ŠçŸ¥ãŒã¾ã ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            <button onclick="showNotificationModal()" class="mt-3 text-emerald-600 hover:text-emerald-700 font-medium">æœ€åˆã®å‘ŠçŸ¥ã‚’ä½œæˆ â†’</button>
          </div>`;
        return;
      }
      
      container.innerHTML = notifications.map(notification => `
        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
          <div class="flex items-center gap-4 flex-1">
            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/></svg>
            </div>
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full">${notification.notification_type || 'å…¨ç”Ÿå¾’'}</span>
                <span class="text-xs text-slate-500">${formatDate(notification.notification_date)}</span>
              </div>
              <p class="text-slate-800 mt-1 line-clamp-2">${notification.notification_content || ''}</p>
            </div>
          </div>
          <div class="flex items-center gap-3 ml-4">
            <span class="px-3 py-1 text-xs font-medium rounded-full ${notification.notification_status === 'é€ä¿¡æ¸ˆ' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}">${notification.notification_status || 'ä¿ç•™'}</span>
            <button onclick="confirmDelete('notification', '${notification.__backendId}', 'ã“ã®å‘ŠçŸ¥')" class="p-2 hover:bg-red-50 rounded-lg transition-colors text-slate-500 hover:text-red-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    // Logs
    function renderLogsList() {
      const notifications = getDataByType('notification');
      const container = document.getElementById('logs-list');
      
      const logs = notifications.filter(n => n.notification_status === 'é€ä¿¡æ¸ˆ');
      
      if (logs.length === 0) {
        container.innerHTML = `
          <div class="p-8 text-center text-slate-400">
            <svg class="w-12 h-12 mx-auto mb-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
            <p>é€ä¿¡ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“</p>
          </div>`;
        return;
      }
      
      container.innerHTML = logs.map(log => `
        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center">
              <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
            </div>
            <div>
              <p class="font-medium text-slate-800">${log.notification_type || 'å‘ŠçŸ¥'}</p>
              <p class="text-sm text-slate-500">${formatDate(log.notification_date)}</p>
            </div>
          </div>
          <span class="px-3 py-1 text-xs font-medium rounded-full bg-emerald-100 text-emerald-700">æˆåŠŸ</span>
        </div>
      `).join('');
    }

    // Delete confirmation
    function confirmDelete(type, id, name) {
      currentDeleteTarget = { type, id };
      document.getElementById('delete-confirm-message').textContent = `ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`;
      document.getElementById('delete-confirm-modal').classList.remove('hidden');
    }

    document.getElementById('delete-confirm-btn').addEventListener('click', async () => {
      if (!currentDeleteTarget) return;
      
      const btn = document.getElementById('delete-confirm-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-spinner"></span>';
      
      const item = allData.find(d => d.__backendId === currentDeleteTarget.id);
      if (item) {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
          showToast('å‰Šé™¤ã—ã¾ã—ãŸ');
        } else {
          showToast('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
      }
      
      btn.disabled = false;
      btn.textContent = 'å‰Šé™¤ã™ã‚‹';
      closeModal('delete-confirm-modal');
      currentDeleteTarget = null;
    });
  </script>
 </body>
</html>